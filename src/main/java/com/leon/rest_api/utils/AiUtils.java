package com.leon.rest_api.utils;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class AiUtils {

    private static final Logger logger = LoggerFactory.getLogger(AiUtils.class);

    /**
     * Accept file name input, ask llm to extract the actual name (remove symbol and ads)
     */
    public static String getNovelNamePrompt(String prompt) {
        logger.info("Analyzing the actual novel name for file : {}", prompt);
        return """
            <è§’è‰²> ä½ æ˜¯ä¸€ä¸ªä¿¡æ¯æŠ½å–åŠ©æ‰‹ã€‚ </è§’è‰²>
            <ä»»åŠ¡> ä»…ä»æä¾›çš„æ–‡æœ¬ç‰‡æ®µä¸­æŠ½å–ä¹¦åã€‚ </ä»»åŠ¡>
            <ä»»åŠ¡> å»é™¤æ‰€æœ‰ç¬¦å·ï¼Œåªè¦ä¹¦å</ä»»åŠ¡>
            <æ ¼å¼>
            jsonæ ¼å¼ ä¹¦åï¼š[ç²¾ç¡®ä¹¦å]
            </æ ¼å¼>
            <è§„åˆ™> å¦‚æœæ‰¾ä¸åˆ°ç›¸å…³ä¿¡æ¯ï¼Œè¯·å›ç­”â€œunknown_nameâ€ã€‚ </è§„åˆ™>

            <æ–‡æœ¬ç‰‡æ®µ>:
            %s

            </æ–‡æœ¬ç‰‡æ®µ>
            <é—®é¢˜>: è¯·æŠ½å–ä¹¦åå’Œä½œè€…ã€‚
            </é—®é¢˜>""".formatted(prompt);
    }

    /**
     * Accept file name input, ask llm to extract the actual name (remove symbol and ads)
     */
    public static String getEncodingCheckerPrompt(String prompt) {
        logger.info("Analyzing the correct encoding for the file : {}", prompt);
        return """
            <è§’è‰²> ä½ æ˜¯ä¸€ä¸ªæ–‡å­—éªŒè¯åŠ©æ‰‹ã€‚ </è§’è‰²>
            <ä»»åŠ¡>
            æ£€æŸ¥æ–‡å­—æ˜¯å¦è§£ç æˆåŠŸã€‚
            å¦‚æœè¾“å…¥æ–‡å­—æ˜¯äººç±»å¯è¯»æ–‡å­—ï¼ˆä¸­æ–‡/è‹±æ–‡ï¼‰ï¼Œå³è§£ç æˆåŠŸã€‚
            </ä»»åŠ¡>
            <è¾“å‡ºæ ¼å¼è¦æ±‚>
            è¯·ä¸¥æ ¼è¿”å›åˆæ³• JSONï¼Œå¿…é¡»ä½¿ç”¨è‹±æ–‡åŒå¼•å·åŒ…è£¹ key ä¸ stringã€‚
            å¦‚æœå…¨éƒ¨éƒ½è§£ç å¤±è´¥ï¼Œè¯·è¿”å›ç©ºæ•°ç»„ï¼š{}
            å¦‚æœæœ‰è§£ç æˆåŠŸçš„æ¡ˆä¾‹ï¼Œè¯·è¿”å› JSON æ•°ç»„ï¼Œä¾‹å¦‚ï¼š
            [{"encoding": utf-8, "lang":"chineseâ€œ , "text_sample": "ç¬¬1ç«  æ‹¿é”™å‰§æœ¬äº†ï¼"},
            {"encoding": gbk, "lang":"chineseâ€œ , "text_sample": "ç¬¬2ç«  æˆ‘æ¥äº†ï¼"}]
            </è¾“å‡ºæ ¼å¼è¦æ±‚>

            <è§„åˆ™>å¦‚æœæœ‰è¶…è¿‡ä¸€ä¸ªç¼–ç æ˜¯äººç±»å¯è¯»æ–‡å­—ï¼ŒæŠŠ utf-8 æˆ– gbk æ”¾åœ¨ç¬¬ä¸€é¡ºä½
            è¾¨è¯†è§£ç å‡ºæ¥çš„è¯­è¨€ï¼Œä¸­æ–‡è¿”å› chinese è‹±æ–‡è¿”å› english </è§„åˆ™>

            <æ–‡æœ¬ç‰‡æ®µ>:
            %s

            </æ–‡æœ¬ç‰‡æ®µ>
            <é—®é¢˜>: æ£€æŸ¥æ–‡å­—æ˜¯å¦è§£ç æˆåŠŸæˆäººç±»å¯è¯»æ–‡å­—ï¼ˆä¸­æ–‡/è‹±æ–‡ï¼‰ã€‚
            </é—®é¢˜>""".formatted(prompt);
    }

    /**
     * Accept file name input, ask llm to extract the actual name (remove symbol and ads)
     */
    public static String getNovelChapterPrompt(String prompt) {
        logger.info("Analyzing the novel chapter...");
        return """
            <è§’è‰²> ä½ æ˜¯ä¸€ä¸ªä¿¡æ¯æŠ½å–åŠ©æ‰‹ï¼Œä¸“é—¨ä»æ–‡æœ¬ä¸­è¯†åˆ«å°è¯´ç« èŠ‚ã€‚ </è§’è‰²>
            <ä»»åŠ¡>
            ä½ éœ€è¦ä»æä¾›çš„æ–‡æœ¬ç‰‡æ®µä¸­ï¼Œæ‰¾å‡ºæ‰€æœ‰â€œç« èŠ‚æ ‡é¢˜â€åŠå…¶æ‰€åœ¨çš„è¡Œå·ï¼ˆlineï¼‰ã€‚
            åªè¦æ˜¯ç« èŠ‚ï¼ˆç¬¬xç« ã€Chapter xã€å·xç«  ç­‰ï¼‰éƒ½è¦æå–ã€‚
            å¿½ç•¥å·ä¿¡æ¯ï¼ˆå¦‚â€œç¬¬ä¸€å·â€ã€â€œåºç« â€ï¼‰ï¼Œåªæå–ç« èŠ‚å±‚çº§ã€‚
            </ä»»åŠ¡ >

            <è¾“å‡ºæ ¼å¼è¦æ±‚>
            è¯·ä¸¥æ ¼è¿”å›åˆæ³• JSONï¼Œå¿…é¡»ä½¿ç”¨è‹±æ–‡åŒå¼•å·åŒ…è£¹ key ä¸ stringã€‚
            å¦‚æœæ‰¾ä¸åˆ°ä»»ä½•ç« èŠ‚ï¼Œè¯·è¿”å›ç©ºæ•°ç»„ï¼š []
            å¦‚æœæ‰¾åˆ°ç« èŠ‚ï¼Œè¯·è¿”å› JSON æ•°ç»„ï¼Œä¾‹å¦‚ï¼š
            [{"line": 20, "chapter_desc": "ç¬¬1ç«  æ‹¿é”™å‰§æœ¬äº†ï¼"}, {"line": 100, "chapter_desc": "ç¬¬1å…«ä¸€ç«  æ˜†ä»‘æ¥å®¢"},
            {"line": 100, "chapter_desc": "ç¬¬ä¸€å››äº”ç«  ç¥å¥‡ç™¾æ…•å¤§"}]
            </è¾“å‡ºæ ¼å¼è¦æ±‚>

            <è§„åˆ™>
            - ä¸è¦è¿”å›è§£é‡Šã€æ–‡å­—ã€æ³¨é‡Šæˆ–å…¶ä»–è¯´æ˜ã€‚
            - åªè¾“å‡º JSON æ•°ç»„ã€‚
            - å¦‚æœä¸ç¡®å®šï¼Œè¯·è¿”å› {}ã€‚
            </è§„åˆ™>

            <æ–‡æœ¬ç‰‡æ®µ>
            %s
            </æ–‡æœ¬ç‰‡æ®µ>
            <é—®é¢˜>
            è¯·æŠ½å–æ‰€æœ‰ç« èŠ‚æ ‡é¢˜åŠå¯¹åº”è¡Œå·ï¼ˆlineï¼‰ã€‚
            </é—®é¢˜>""".formatted(prompt);
    }

    /**
     * Ask LLM to detect lines that ARE chapter titles and return
     * their line numbers in JSON format like:
     * [{"line": 14525}, {"line": 14609}]
     */
    public static String getNovelChapterPromptV2(String prompt) {
        logger.info("ğŸ” Detecting chapter title lines...");
        return """
            <è§’è‰²>ä½ æ˜¯ä¸€ä¸ªä¿¡æ¯æŠ½å–åŠ©æ‰‹ï¼Œä¸“é—¨ä»æ–‡æœ¬ä¸­è¯†åˆ«å°è¯´ç« èŠ‚ã€‚</è§’è‰²>
            <ä»»åŠ¡>
            ä½ éœ€è¦ä»æä¾›çš„æ–‡æœ¬ç‰‡æ®µä¸­ï¼Œæ‰¾å‡ºæ‰€æœ‰â€œç« èŠ‚æ ‡é¢˜â€æ‰€åœ¨çš„è¡Œå·lineã€‚
            åªè¦æ˜¯ç« èŠ‚ï¼ˆä¾‹å¦‚ï¼šç¬¬xç« ã€Chapter xã€å·xç«  ã€ï½ç¬¬äºŒåä¸€ç«  å®éªŒç”¨çš„å°ç™½é¼ ï¼ˆ3ï¼‰ï½ï¼‰éƒ½è¦é€‰ä¸­ã€‚
            å¿½ç•¥å·ä¿¡æ¯ï¼ˆå¦‚â€œç¬¬ä¸€å·â€ã€â€œåºç« â€ï¼‰ï¼Œåªé€‰ä¸­ç« èŠ‚å±‚çº§ã€‚å¿½ç•¥ä»»ä½•çš„æ•…äº‹æˆ–æ•˜äº‹å†…å®¹çš„lineï¼Œåªè¦ç« èŠ‚çš„line
            </ä»»åŠ¡>

            <è¾“å‡ºæ ¼å¼è¦æ±‚>
            è¯·ä¸¥æ ¼è¿”å›åˆæ³•çš„ JSONï¼Œå¿…é¡»ä½¿ç”¨è‹±æ–‡åŒå¼•å·åŒ…è£¹ key å’Œå­—ç¬¦ä¸²ã€‚
            å¦‚æœæ‰¾ä¸åˆ°ä»»ä½•ç« èŠ‚ï¼Œè¯·è¿”å›ç©ºæ•°ç»„ï¼š[]ã€‚
            å¦‚æœæ‰¾åˆ°ç« èŠ‚ï¼Œè¯·è¿”å› JSON æ•°ç»„ï¼Œä¾‹å¦‚ï¼š
            [{"line": 20}, {"line": 100}, {"line": 120}]
            </è¾“å‡ºæ ¼å¼è¦æ±‚>

            <è§„åˆ™>
            - ä¸è¦è¿”å›è§£é‡Šã€æ–‡å­—ã€æ³¨é‡Šæˆ–å…¶ä»–è¯´æ˜ã€‚
            - åªè¾“å‡º JSON æ•°ç»„ã€‚
            - å¦‚æœä¸ç¡®å®šï¼Œè¯·è¿”å›ç©ºæ•°ç»„ []ã€‚
            </è§„åˆ™>

            <æ–‡æœ¬ç‰‡æ®µ>
            %s
            </æ–‡æœ¬ç‰‡æ®µ>
            <é—®é¢˜>
            è¯·æŠ½å–æ‰€æœ‰ç« èŠ‚æ ‡é¢˜å¯¹åº”çš„è¡Œå·ï¼ˆlineï¼‰ã€‚
            </é—®é¢˜>""".formatted(prompt);
    }
}
